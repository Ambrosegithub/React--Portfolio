"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4635],{24713:function(e,t,n){n.d(t,{U:function(){return C}});var i=n(59499),r=n(50029),o=n(87794),a=n.n(o),s=n(92777),l=n(82262),c=n(41495),u=n(65342),f=n.n(u),p=n(85456),h=n(56726),d=n(8165),m=n(96517);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function(){function e(t,n,r,o){var a=this;(0,s.Z)(this,e),(0,i.Z)(this,"task",void 0),(0,i.Z)(this,"completedTask",null),(0,i.Z)(this,"file",void 0),(0,i.Z)(this,"options",void 0),(0,i.Z)(this,"r",null),(0,i.Z)(this,"metaData",void 0),(0,i.Z)(this,"hasCompleted",!1),(0,i.Z)(this,"isAcknowledgementComplete",!1),(0,i.Z)(this,"joinInterval",null),(0,i.Z)(this,"confirmInterval",null),(0,i.Z)(this,"taskCompleteTimeout",null),(0,i.Z)(this,"handleTaskComplete",(function(e){a.completedTask=e,a.isAcknowledgementComplete&&(a.options.onComplete(e,a.metaData),a.hasCompleted=!0,a.taskCompleteTimeout&&clearTimeout(a.taskCompleteTimeout))})),(0,i.Z)(this,"handleOfflineLimit",(function(e){a.options.onOfflineLimitReach&&a.options.onOfflineLimitReach(e,a.metaData)})),(0,i.Z)(this,"handleTaskFail",(function(e){var t,n;null===(t=a.r)||void 0===t||t.pause(),null===(n=a.r)||void 0===n||n.cancel(),a.cancel(),a.options.onFailure(e,a.metaData)})),(0,i.Z)(this,"handleReconnect",(function(){a.r&&a.r.upload(),a.options.onReconnect&&a.options.onReconnect(a.task,a.metaData)})),(0,i.Z)(this,"handleDisconnect",(function(){a.r&&a.r.pause(),a.options.onDisconnect&&a.options.onDisconnect(a.task,a.metaData)})),this.task=t,this.file=n,this.options=r,this.metaData=o}return(0,l.Z)(e,[{key:"startImport",value:function(){var e=(0,r.Z)(a().mark((function e(){var t,n=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.M(this.task,{handleDisconnect:this.handleDisconnect,handleReconnect:this.handleReconnect,handleTaskComplete:function(e){n.handleTaskComplete(e)},handleTaskFail:this.handleTaskFail,onOfflineLimitReach:this.handleOfflineLimit}),e.next=3,t.appendTask(!1);case 3:this.init();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e,t,n,i,o=this;this.r&&this.r.pause();var s=null===(e=this.task.result)||void 0===e||null===(t=e.form)||void 0===t?void 0:t.url.toString(),l=null===(n=this.task.result)||void 0===n||null===(i=n.form)||void 0===i?void 0:i.parameters;if(s&&this.file&&this.file.file){var u=this.file.file,p=(0,c.Z)(this.file.file),d=new(f())({target:s.replace("api/upload","api/resumable").replace("server","s"),chunkSize:2048e3,chunkRetryInterval:3e3,prioritizeFirstAndLastChunk:!0,query:k({},l),generateUniqueIdentifier:function(){var e=u.webkitRelativePath||u.name,t=u.size;return e.length<40?t+"-"+Math.floor(1e3*Math.random()+5e3)+"-"+e.replace(/[^0-9a-zA-Z_-]/gim,"")+"."+p:(e=e.replace(/[^0-9a-zA-Z_-]/gim,""),t+"-"+Math.floor(1e3*Math.random()+5e3)+"-"+e.substring(0,20)+"-"+e.substring(e.length-20)+"."+p)}});this.r=d;var m=new Date;d.addFile(this.file.file),d.on("fileAdded",(function(){d.upload()})),d.on("error",(function(e,t){t.retry()})),d.on("fileError",(function(){o.options.onFailure(o.task,o.metaData)})),d.on("fileProgress",(function(){var e=Math.round(100*d.progress()),t=((new Date).getTime()-m.getTime())/1e3;o.options.onProgress(o.task,e,function(e,t,n){var i=Number(t)*n/100,r=(0,h.t)(i/e);return"".concat(Math.round(Number(r.split(" ")[0]))," ").concat(r.split(" ")[1])}(t,e,o.file.file.size),o.metaData)})),d.on("fileSuccess",(function(e,t){var n=JSON.parse(t).fileUploadStatus;"done"!==n&&"partly_done"!==n||d.on("complete",(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.handleJoin();case 1:case"end":return e.stop()}}),e)}))))})),d.on("fileRetry",(function(e){o.r&&e.retry()}))}else this.options.onFailure(this.task,this.metaData)}},{key:"cancel",value:function(){this.r&&(this.r.pause(),this.r.cancel(),this.destroy(),this.r=null,this.options={onComplete:function(){},onFailure:function(){},onOfflineLimitReach:function(){},onProgress:function(){}})}},{key:"handleJoin",value:function(){var e,t,n,i,o,s,l=this,c=null===(e=this.task.result)||void 0===e||null===(t=e.form)||void 0===t?void 0:t.url.toString();if(c&&this.r&&null!==(n=this.task.result)&&void 0!==n&&null!==(i=n.form)&&void 0!==i&&i.parameters.signature){var u=new FormData;u.append("identifier",this.getIdentifier()),u.append("signature",null!==(o=null===(s=this.task.result.form)||void 0===s?void 0:s.parameters.signature)&&void 0!==o?o:""),(0,p.v)(c.replace("api/upload","api/resumable/join").replace("server","s"),u).then((function(){l.handleConfirm()})).catch(function(){var e=(0,r.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.joinInterval=setInterval((function(){(0,p.v)(c.replace("api/upload","api/resumable/join").replace("server","s"),u).then((function(){l.handleConfirm(),l.joinInterval&&clearInterval(l.joinInterval)}))}),5e3);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}},{key:"handleConfirm",value:function(){var e,t,n,i,o,s,l=this,c=null===(e=this.task.result)||void 0===e||null===(t=e.form)||void 0===t?void 0:t.url.toString();if(c&&this.r&&null!==(n=this.task.result)&&void 0!==n&&null!==(i=n.form)&&void 0!==i&&i.parameters.signature){var u=new FormData;u.append("identifier",this.getIdentifier()),u.append("fileName",this.file.file.name),u.append("signature",null!==(o=null===(s=this.task.result.form)||void 0===s?void 0:s.parameters.signature)&&void 0!==o?o:""),(0,p.v)(c.replace("server","s"),u).then((0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.isAcknowledgementComplete=!0,l.completedTask&&!l.hasCompleted&&(l.hasCompleted=!0,l.options.onComplete(l.completedTask,l.metaData));case 2:case"end":return e.stop()}}),e)})))).catch((function(){l.confirmInterval=setInterval((function(){(0,p.v)(c.replace("server","s"),u).then((0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.isAcknowledgementComplete=!0,l.completedTask&&!l.hasCompleted&&(l.hasCompleted=!0,l.options.onComplete(l.completedTask,l.metaData)),l.confirmInterval&&clearInterval(l.confirmInterval);case 3:case"end":return e.stop()}}),e)}))))}),5e3)})),this.taskCompleteTimeout=setTimeout((function(){l.hasCompleted||(0,m.S)("event","Upload Stuck",{event_category:"/"===window.location.pathname?"Image Resizer":window.location.pathname,event_label:"Upload"})}),1e4)}}},{key:"getIdentifier",value:function(){return this.r?this.r.files.map((function(e){return e.uniqueIdentifier})).join(","):""}},{key:"destroy",value:function(){this.joinInterval&&clearInterval(this.joinInterval),this.confirmInterval&&clearInterval(this.confirmInterval)}}]),e}(),O=n(67294);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=[],C=function(e){var t=function(){var t=(0,r.Z)(a().mark((function t(i,r,o){var s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.onStart(r,o,0),s=new g(r,i,y(y({},e),{},{onOfflineLimitReach:n}),o),t.next=4,s.startImport();case 4:b.push(s);case 5:case"end":return t.stop()}}),t)})));return function(e,n,i){return t.apply(this,arguments)}}(),n=function(t,n){e.onOfflineLimitReach&&e.onOfflineLimitReach(t,n);var i=b.find((function(e){return e.task.id===t.id}));null===i||void 0===i||i.cancel()};return(0,O.useEffect)((function(){return function(){"undefined"!==typeof e.shouldCancelOnUnmount&&!1===e.shouldCancelOnUnmount||b.forEach((function(e){return e.cancel()}))}}),[]),{handleDeviceCancel:function(e){var t=b.find((function(t){return t.task.id===e.id}));null===t||void 0===t||t.cancel()},handleDeviceImport:t,handleCancelAllDeviceImports:function(){b.forEach((function(e){return e.cancel()}))}}}},85127:function(e,t,n){n.d(t,{_:function(){return a}});var i=n(50029),r=n(87794),o=n.n(r),a=function(){var e=(0,i.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=setTimeout((function(){e(void 0),clearTimeout(n)}),null!==t&&void 0!==t?t:10)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=4635-abeadc373b125819.js.map